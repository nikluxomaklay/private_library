# Task 003-notes

## Общее описание:
Нужно добавить в систему возможность вести карточки с заметками по системе Zettelkasten.

## User story 1: Просмотр списка заметок
**Как пользователь системы**, я хочу видеть в боковом меню новый пункт 'Notes'.
При переходе по ссылке я попадаю на список заметок.

### Организация списка:
- В списке нужно выводить заметки в иерархическом виде
- Для индикации зависимостей использовать отступы
- Пагинацию производить по верхнеуровневым заметкам (у которых нет родителя)
- Если у верхнеуровневой заметки есть дочерние, то они все должны быть выведены на текущей странице
- Отображать Индекс и тему заметки
- Индекс - ссылка на детальную страницу

## User story 2: Просмотр детальной страницы
**Как пользователь системы**, я хочу при переходе на детальную страницу Note увидеть следующую информацию:
- Индекс
- Тема
- Текст заметки
- Родительская заметка
- Связанное книжное издание + дополнительная информация о книжном издании (в одной строке)
- Ключевые слова
- Связанные заметки (индекс + тема)
- Дата создания + дата обновления (в одной строке)

## User story 3: Просмотр заметок на странице книжного издания
**Как пользователь системы**, я хочу видеть связанные заметки на детальной странице книжного издания.
Отображать иерархически, используя отступы.

## User story 4: Добавление заметки со страницы списка заметок
**Как пользователь системы**, я хочу иметь возможность создать новую заметку, находясь на странице списка заметок.
Нужно добавить в блок действий кнопку New note.
Кнопка ведет на страницу создания заметки.

### Страница создания заметки
- Тема - строка (255 символов; обязательное)
- Текст заметки - текстовое поле (не обязательное)
- Книжное издание - inline список:
  - Каждый элемент состоит из двух полей:
    - Книжное издание - селектор с live-поиском и асинхронной загрузкой данных (не обязательное)
    - Уточнения к книжному изданию - текстовое поле (не обязательное; доступно для редактирования только если выбрано книжное издание; если книжное издание не выбрано, то поле должно быть пустое)
  - Есть возможность добавить элемент в конец списка
  - Есть возможность убрать произвольный элемент списка
- Родительская заметка - селектор с live-поиском и асинхронной загрузкой данных (не обязательное)
- Ключевые слова - селектор с live-поиском и асинхронной загрузкой данных (не обязательное)

## User story 5: Добавление заметки со страницы книжного издания
**Как пользователь системы**, я хочу иметь возможность создать новую заметку, находясь на детальной странице книжного издания.
Нужно добавить в блок действий кнопку New note.
Кнопка ведет на страницу создания заметки с предзаполненным полем Книжное издание.

## User story 6: Добавление заметки со страницы другой заметки
**Как пользователь системы**, я хочу иметь возможность создать новую заметку, находясь на детальной странице другой заметки.
Нужно добавить в блок действий кнопку New note.
Кнопка ведет на страницу создания заметки с предзаполненными полями Родительская заметка, Книжное издание и Ключевые слова.

## User story 7: Изменение заметки
**Как пользователь системы**, я хочу иметь возможность изменить любую существующую заметку

### Страница изменить заметки
Аналогична странице создания заметки.
- Тема - строка (255 символов; обязательное)
- Текст заметки - текстовое поле (не обязательное)
- Книжное издание - inline список:
  - Каждый элемент состоит из двух полей:
    - Книжное издание - селектор с live-поиском и асинхронной загрузкой данных (не обязательное)
    - Уточнения к книжному изданию - текстовое поле (не обязательное; доступно для редактирования только если выбрано книжное издание; если книжное издание не выбрано, то поле должно быть пустое)
  - Есть возможность добавить элемент в конец списка
  - Есть возможность убрать произвольный элемент списка
- Родительская заметка - селектор с live-поиском и асинхронной загрузкой данных (не обязательное)
- Ключевые слова - селектор с live-поиском и асинхронной загрузкой данных (не обязательное)

## Дополнительная информация и ограничения
- Новое app создавать не нужно, требуется реализовать заметки в рамках core (модели и связанная с ними логика) и front (views, forms, static, urls) приложений.
- Модели данных уже реализованы:
  - Note - основная модель заметок
    - index - индекс заметки, генерируется автоматически при вызове save_base (уже реализовано)
    - parent - родительская заметка
    - related_notes - M2M связанные заметки
    - keywords - M2M ключевые слова
    - topic - тема заметки
    - text - текст заметки
    - created_at - дата создания
    - updated_at - дата обновления
  - NoteToBookEdition - для M2M связи заметки с книжными изданиями с дополнительной информацией
    - note - Fk на заметку
    - book_edition - Fk на книжное издание
    - additional_info - Дополнительная информация
  - KeyWord - ключевые слова для заметок:
    - word - поле для ключевого слова
- Другие модели создавать не нужно. Миграция тоже уже есть.
- Для реализации селекторов с live-поиском и асинхронной загрузкой данных нужно в качестве примера использовать поле Publisher на странице создания Book edition.
- В модели Note уже указано ограничение на удаление родительской заметки: on_delete=models.PROTECT
- Генерация индекса заметки уже реализована в Note.base_save
- При сохранении заметки система должна проверять наличие циклических зависимостей в иерархии и блокировать создание цикла с сообщением об ошибке